<div class="container-fluid">
  <h5 class="mt-3">Product List</h5>
  <div class="row mt-2">
    <div class="col-md-2">
      <ng-select
        name="categoryid"
        [items]="categories$ | async"
        bindLabel="name"
        bindValue="id"
        placeholder="Filter Category"
        [(ngModel)]="categoryid"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <ng-select
        name="filtered_brand"
        [items]="brands$ | async"
        bindLabel=""
        bindValue=""
        placeholder="Filter Brands"
        [(ngModel)]="filtered_brand"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <ng-select
        name="filtered_flavourtype"
        [items]="flavourtypes$ | async"
        bindLabel=""
        bindValue=""
        placeholder="Filter Flavour"
        [(ngModel)]="filtered_flavourtype"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <ng-select
        name="filtered_origin"
        [items]="origins$ | async"
        bindLabel=""
        bindValue=""
        placeholder="Filter Origin"
        [(ngModel)]="filtered_origin"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <div class="d-flex">
        <input
          type="text"
          class="form-control"
          placeholder="search content"
          #queryText
        />
        <button
          type="button"
          class="btn btn-warning ms-1"
          (click)="onSearch(queryText.value)"
        >
          Search
        </button>
      </div>
    </div>
    <div class="col-md-2">
      <div class="d-flex justify-content-end">
        <a
          role="button"
          class="btn btn-success"
          data-bs-toggle="tooltip"
          title="Export To Excel"
          (click)="exportToExcel()"
        >
          <i class="bi bi-file-earmark-spreadsheet-fill fs-3"></i>
        </a>
        <ng-container
          *ngIf="
            user !== undefined &&
            (user?.roles?.includes('MANAGER') || user?.roles?.includes('ADMIN'))
          "
        >
          <a
            [routerLink]="['/admin/products/add']"
            class="btn btn-primary ms-2"
            routerLinkActive="router-link-active"
            >Add Product</a
          >
        </ng-container>
      </div>
    </div>
  </div>
  <div class="row mt-2">
    <div class="col-md-2">
      <ng-select
        name="filtered_sku"
        [items]="skus$ | async"
        bindLabel=""
        bindValue=""
        placeholder="Filter SKU"
        [(ngModel)]="filtered_sku"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <ng-select
        name="packtypeid"
        [items]="packtypes$ | async"
        bindLabel="name"
        bindValue="id"
        placeholder="Filter Pack Type"
        [(ngModel)]="packtypeid"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <ng-select
        name="cylindercompanyid"
        [items]="cylinderCompanies$ | async"
        bindLabel="name"
        bindValue="id"
        placeholder="Filter Cylinder Company"
        [(ngModel)]="cylindercompanyid"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <ng-select
        name="printingcompanyid"
        [items]="printingCompanies$ | async"
        bindLabel="name"
        bindValue="id"
        placeholder="Filter Printing Company"
        [(ngModel)]="printingcompanyid"
        [searchable]="true"
        class="material-ng-select"
        (change)="onSearch(queryText.value)"
      >
      </ng-select>
    </div>
    <div class="col-md-2">
      <div class="d-flex justify-content-end">
        <label for="pageSize" class="ms-1">Page Size</label>
        <select
          class="ms-1"
          name="pageSize"
          id="pageSize"
          #selectPageSize
          (change)="onPageSizeChange(selectPageSize.value)"
        >
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
    </div>
    <div class="col-md-2"></div>
  </div>
  <div class="d-flex justify-content-between mt-3"></div>
  <ng-container *ngIf="products$ | async as products">
    <div class="table-responsive mt-3">
      <table class="table table-striped table-bordered">
        <thead class="table-dark text-nowrap">
          <tr>
            <th style="display: none">Id</th>
            <th>Category</th>
            <th>Brand</th>
            <th>Flavour</th>
            <th>Origin</th>
            <th>SKU</th>
            <th>Code</th>
            <th>Pack Type</th>
            <th>Barcode</th>
            <th>Date</th>
            <th>Cylinder</th>
            <th>Printing</th>
            <th style="min-width: 200px">Versions</th>
            <th style="min-width: 150px">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products" class="fs-6">
            <td style="display: none">{{ product.id }}</td>
            <td>
              {{ product.category.name }}
            </td>
            <td>
              {{ product.brand }}
            </td>
            <td>{{ product.flavourType }}</td>
            <td>
              {{ product.origin }}
            </td>
            <td>
              {{ product.sku }}
            </td>
            <td>{{ product.productCode }}</td>
            <td>
              {{ product.packType.name }}
            </td>
            <td>
              {{ product.barcode }}
            </td>
            <td>
              {{ product.projectDate | date : "mediumDate" }}
            </td>
            <td>
              {{ product.cylinderCompany.name }}
            </td>
            <td>
              {{ product.printingCompany.name }}
            </td>
            <td>
              <div
                class=""
                *ngFor="let productVersion of product.productVersions"
              >
                <a
                  class="text-primary"
                  (click)="openShowProductVersionModal(productVersion.id)"
                  role="button"
                  >{{ productVersion.version }} [{{
                    productVersion.versionDate | date : "yyyy-MM-dd"
                  }}]
                </a>
                <ng-container
                  *ngIf="user !== undefined && user?.roles?.includes('ADMIN')"
                >
                  <a
                    class="text-danger"
                    role="button"
                    (click)="deleteProductVersion(productVersion.id)"
                    ><i class="bi bi-trash3"></i
                  ></a>
                </ng-container>

                <br />
              </div>
            </td>
            <td>
              <a
                class="text-info ms-3"
                target="_blank"
                (click)="openViewProduct(product.id)"
                data-bs-toggle="tooltip"
                title="View Product"
                ><i class="bi bi-binoculars-fill fs-3"></i
              ></a>
              <ng-container
                *ngIf="
                  user !== undefined &&
                  (user?.roles?.includes('MANAGER') ||
                    user?.roles?.includes('ADMIN'))
                "
              >
                <a
                  class="text-primary ms-3"
                  (click)="openProductVersionModal(product.id)"
                  data-bs-toggle="tooltip"
                  title="Add Product Version"
                  ><i class="bi bi-cloud-plus-fill fs-3"></i
                ></a>
                <a
                  class="text-warning ms-3"
                  [routerLink]="['/admin/products', product.id]"
                  data-bs-toggle="tooltip"
                  title="Edit Product Master"
                >
                  <i class="bi bi-pencil-square fs-3"></i>
                </a>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <nav aria-label="Pagination">
      <ul class="pagination justify-content-left">
        <li class="page-item" [class.disabled]="pageNumber === 1">
          <a class="page-link" (click)="getPage(1)">First</a>
        </li>
    
        <li class="page-item" [class.disabled]="pageNumber === 1">
          <a class="page-link" (click)="getPrevPage()">Previous</a>
        </li>
    
        <li *ngFor="let page of smartPageList"
            class="page-item"
            [class.active]="page === pageNumber"
            [class.disabled]="page === '...'">
          <a class="page-link" *ngIf="page !== '...'" (click)="onPageClick(page)">
            {{ page }}
          </a>
          <span class="page-link" *ngIf="page === '...'">â€¦</span>
        </li>
    
        <li class="page-item" [class.disabled]="pageNumber === totalPages">
          <a class="page-link" (click)="getNextPage()">Next</a>
        </li>
    
        <li class="page-item" [class.disabled]="pageNumber === totalPages">
          <a class="page-link" (click)="getPage(totalPages)">Last</a>
        </li>
      </ul>
    </nav>
    
    

    <!-- <nav aria-label="Page navigation example">
      <ul class="pagination">
        <li class="page-item">
          <a class="page-link" (click)="getPrevPage()">Previous</a>
        </li>

        <li *ngFor="let item of page_list; let index = index" class="page-item">
          <a class="page-link" (click)="getPage(index + 1)">{{ index + 1 }}</a>
        </li>

        <li class="page-item">
          <a class="page-link" (click)="getNextPage()">Next</a>
        </li>
      </ul>
    </nav> -->
  </ng-container>
</div>
<div
  [ngClass]="{
    'd-block': isProductVersionModalVisible,
    'd-none': !isProductVersionModalVisible
  }"
  class="product-version-modal"
>
  <button
    type="button"
    class="btn btn-light"
    style="position: fixed; top: 60px; right: 10px"
    (click)="closeProductVersionModal()"
  >
    X
  </button>
  <app-add-productversion
    *ngIf="isProductVersionModalVisible"
    [data]="master_product_id"
    (refreshParent)="loadData()"
  ></app-add-productversion>
</div>

<div
  [ngClass]="{
    'd-block': isShowProductVersionModalVisible,
    'd-none': !isShowProductVersionModalVisible
  }"
  class="show-product-version-modal"
>
  <button
    type="button"
    class="btn btn-light"
    style="position: fixed; top: 60px; right: 10px"
    (click)="closeShowProductVersionModal()"
  >
    X
  </button>
  <app-show-productversion
    *ngIf="isShowProductVersionModalVisible"
    [data]="product_version_id"
    (refreshParent)="loadData()"
  ></app-show-productversion>
</div>
