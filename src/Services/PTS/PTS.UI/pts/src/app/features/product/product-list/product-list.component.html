<div class="container">
  <h5 class="mt-3">Product List</h5>

  <div class="d-flex justify-content-between mt-3">
    <div class="d-flex">
      <input
        type="text"
        class="form-control"
        placeholder="search content"
        #queryText
      />
      <button
        type="button"
        class="btn btn-warning ms-1"
        (click)="onSearch(queryText.value)"
      >
        Search
      </button>
      <label for="pageSize" class="ms-1">Page Size</label>
      <select
        class="ms-1"
        name="pageSize"
        id="pageSize"
        #selectPageSize
        (change)="onPageSizeChange(selectPageSize.value)"
      >
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>
    <a
      [routerLink]="['/admin/products/add']"
      class="btn btn-primary"
      routerLinkActive="router-link-active"
      >Add Product</a
    >
  </div>
  <ng-container *ngIf="products$ | async as products">
    <div class="table-responsive mt-3">
      <table class="table table-striped table-bordered">
        <thead class="table-dark text-nowrap">
          <tr>
            <th style="display: none">Id</th>
            <th style="min-width: 200px">Versions</th>
            <th style="min-width: 100px">Action</th>
            <th>Category</th>
            <th>Brand</th>
            <th>Flavour</th>
            <th>Origin</th>
            <th>SKU</th>
            <th>Code</th>
            <th>Pack Type</th>
            <th>Barcode</th>
            <th>Date</th>
            <th>Cylinder</th>
            <th>Printing</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products" class="fs-6">
            <td style="display: none">{{ product.id }}</td>
            <td>
              <div
                class=""
                *ngFor="let productVersion of product.productVersions"
              >
                <a
                  class="text-primary"
                  (click)="openShowProductVersionModal(productVersion.id)"
                  role="button"
                  >{{ productVersion.version }} [{{
                    productVersion.versionDate | date : "yyyy-MM-dd"
                  }}]
                </a>
                <a
                  class="text-danger"
                  role="button"
                  (click)="deleteProductVersion(productVersion.id)"
                  ><i class="bi bi-trash3"></i
                ></a>
                <br />
              </div>
            </td>
            <td>
              <a
                class="text-primary ms-1"
                (click)="openProductVersionModal(product.id)"
                data-bs-toggle="tooltip"
                title="Add Product Version"
                ><i class="bi bi-cloud-plus-fill fs-3"></i
              ></a>
              <a
                class="text-warning ms-3"
                [routerLink]="['/admin/products', product.id]"
                data-bs-toggle="tooltip"
                title="Edit Product Master"
              >
                <i class="bi bi-pencil-square fs-3"></i>
              </a>
            </td>
            <td>
              {{ product.category.name }}
            </td>
            <td>
              {{ product.brand }}
            </td>
            <td>{{ product.flavourType }}</td>
            <td>
              {{ product.origin }}
            </td>
            <td>
              {{ product.sku }}
            </td>
            <td>{{ product.productCode }}</td>
            <td>
              {{ product.packType.name }}
            </td>
            <td>
              {{ product.barcode }}
            </td>
            <td>
              {{ product.projectDate | date : "mediumDate" }}
            </td>
            <td>
              {{ product.cylinderCompany.name }}
            </td>
            <td>
              {{ product.printingCompany.name }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <nav aria-label="Page navigation example">
      <ul class="pagination">
        <li class="page-item">
          <a class="page-link" (click)="getPrevPage()">Previous</a>
        </li>

        <li *ngFor="let item of page_list; let index = index" class="page-item">
          <a class="page-link" (click)="getPage(index + 1)">{{ index + 1 }}</a>
        </li>

        <li class="page-item">
          <a class="page-link" (click)="getNextPage()">Next</a>
        </li>
      </ul>
    </nav>
  </ng-container>
</div>
<div
  [ngClass]="{
    'd-block': isProductVersionModalVisible,
    'd-none': !isProductVersionModalVisible
  }"
  class="product-version-modal"
>
  <button
    type="button"
    class="btn btn-light"
    style="position: fixed; top: 60px; right: 10px"
    (click)="closeProductVersionModal()"
  >
    X
  </button>
  <app-add-productversion
    *ngIf="isProductVersionModalVisible"
    [data]="master_product_id"
    (refreshParent)="loadData()"
  ></app-add-productversion>
</div>

<div
  [ngClass]="{
    'd-block': isShowProductVersionModalVisible,
    'd-none': !isShowProductVersionModalVisible
  }"
  class="show-product-version-modal"
>
  <button
    type="button"
    class="btn btn-light"
    style="position: fixed; top: 60px; right: 10px"
    (click)="closeShowProductVersionModal()"
  >
    X
  </button>
  <app-show-productversion
    *ngIf="isShowProductVersionModalVisible"
    [data]="product_version_id"
    (refreshParent)="loadData()"
  ></app-show-productversion>
</div>
